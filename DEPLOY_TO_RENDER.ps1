# Quick Deploy Script for Next Door Key Simulator to Render.com# This script helps you prepare and deploy the KME serversWrite-Host "======================================================================" -ForegroundColor CyanWrite-Host "  Next Door Key Simulator - Render.com Deployment Helper" -ForegroundColor CyanWrite-Host "======================================================================" -ForegroundColor CyanWrite-Host ""# Step 1: Check if we're in the right directory$expectedPath = "next-door-key-simulator"$currentPath = Get-Locationif ($currentPath.Path -notlike "*$expectedPath*") {    Write-Host "[!] Please run this script from the next-door-key-simulator directory" -ForegroundColor Red    Write-Host "    Current: $currentPath" -ForegroundColor Yellow    Write-Host "    Expected: *\next-door-key-simulator" -ForegroundColor Yellow    Write-Host ""    Read-Host "Press Enter to exit"    exit 1}Write-Host "[1/6] Checking Prerequisites..." -ForegroundColor GreenWrite-Host ""# Check Gittry {    $gitVersion = git --version    Write-Host "  Γ£ô Git installed: $gitVersion" -ForegroundColor Green} catch {    Write-Host "  Γ£ù Git not found. Please install Git first." -ForegroundColor Red    Write-Host "    Download: https://git-scm.com/downloads" -ForegroundColor Yellow    Read-Host "Press Enter to exit"    exit 1}# Check if this is a git repository$isGitRepo = Test-Path ".git"if (-not $isGitRepo) {    Write-Host "  ! Not a Git repository" -ForegroundColor Yellow    $initGit = Read-Host "  Do you want to initialize Git here? (y/n)"    if ($initGit -eq "y") {        git init        Write-Host "  Γ£ô Git repository initialized" -ForegroundColor Green    }}Write-Host ""Write-Host "[2/6] Checking Required Files..." -ForegroundColor GreenWrite-Host ""$requiredFiles = @(    "Dockerfile",    "app.py",    "requirements.txt",    "render-kme1.yaml",    "render-kme2.yaml",    "RENDER_DEPLOYMENT_GUIDE.md")$allFilesPresent = $trueforeach ($file in $requiredFiles) {    if (Test-Path $file) {        Write-Host "  Γ£ô $file" -ForegroundColor Green    } else {        Write-Host "  Γ£ù $file (MISSING)" -ForegroundColor Red        $allFilesPresent = $false    }}if (-not $allFilesPresent) {    Write-Host ""    Write-Host "  Some required files are missing. Please check the directory." -ForegroundColor Red    Read-Host "Press Enter to exit"    exit 1}Write-Host ""Write-Host "[3/6] GitHub Repository Setup" -ForegroundColor GreenWrite-Host ""Write-Host "  You need to push this code to GitHub for Render to deploy it." -ForegroundColor YellowWrite-Host ""Write-Host "  Option 1: Use existing GitHub repository" -ForegroundColor CyanWrite-Host "    - Go to your GitHub repo" -ForegroundColor GrayWrite-Host "    - Ensure this code is pushed" -ForegroundColor GrayWrite-Host ""Write-Host "  Option 2: Create new GitHub repository" -ForegroundColor CyanWrite-Host "    - Go to: https://github.com/new" -ForegroundColor GrayWrite-Host "    - Repository name: next-door-key-simulator" -ForegroundColor GrayWrite-Host "    - Set as Public or Private" -ForegroundColor GrayWrite-Host "    - Don't initialize with README (we already have files)" -ForegroundColor GrayWrite-Host ""$hasGitHub = Read-Host "  Is your code already on GitHub? (y/n)"if ($hasGitHub -ne "y") {    Write-Host ""    Write-Host "  Please follow these steps:" -ForegroundColor Yellow    Write-Host ""    Write-Host "  1. Create a new repository on GitHub" -ForegroundColor White    Write-Host "  2. Copy the repository URL (e.g., https://github.com/username/next-door-key-simulator.git)" -ForegroundColor White    Write-Host ""    $repoUrl = Read-Host "  Enter your GitHub repository URL"        if ($repoUrl) {        try {            git remote remove origin 2>$null            git remote add origin $repoUrl            git add .            git commit -m "Prepare Next Door Key Simulator for Render deployment"            git push -u origin master            Write-Host ""            Write-Host "  Γ£ô Code pushed to GitHub!" -ForegroundColor Green        } catch {            Write-Host ""            Write-Host "  ! Error pushing to GitHub: $_" -ForegroundColor Yellow            Write-Host "  Please push manually using:" -ForegroundColor Yellow            Write-Host "    git remote add origin $repoUrl" -ForegroundColor Gray            Write-Host "    git add ." -ForegroundColor Gray            Write-Host "    git commit -m 'Deploy to Render'" -ForegroundColor Gray            Write-Host "    git push -u origin master" -ForegroundColor Gray        }    }}Write-Host ""Write-Host "[4/6] Render.com Account Setup" -ForegroundColor GreenWrite-Host ""Write-Host "  1. Go to: https://dashboard.render.com/register" -ForegroundColor WhiteWrite-Host "  2. Sign up with your GitHub account (recommended)" -ForegroundColor WhiteWrite-Host "  3. Authorize Render to access your GitHub repositories" -ForegroundColor WhiteWrite-Host ""$hasRenderAccount = Read-Host "  Do you have a Render.com account? (y/n)"if ($hasRenderAccount -ne "y") {    Write-Host ""    Write-Host "  Please create a Render.com account and press Enter when ready..." -ForegroundColor Yellow    Read-Host}Write-Host ""Write-Host "[5/6] Deploy KME Services to Render" -ForegroundColor GreenWrite-Host ""Write-Host "  You'll deploy TWO web services:" -ForegroundColor YellowWrite-Host "    1. qumail-kme-sender (KME 1)" -ForegroundColor CyanWrite-Host "    2. qumail-kme-receiver (KME 2)" -ForegroundColor CyanWrite-Host ""Write-Host "  For each service:" -ForegroundColor WhiteWrite-Host "    ΓÇó Name: qumail-kme-sender (or receiver)" -ForegroundColor GrayWrite-Host "    ΓÇó Runtime: Docker" -ForegroundColor GrayWrite-Host "    ΓÇó Plan: Free" -ForegroundColor GrayWrite-Host "    ΓÇó Health Check: /api/v1/kme/status" -ForegroundColor GrayWrite-Host ""Write-Host "  See RENDER_DEPLOYMENT_GUIDE.md for detailed environment variables." -ForegroundColor WhiteWrite-Host ""Write-Host "  Opening deployment guide..." -ForegroundColor CyanStart-Process "RENDER_DEPLOYMENT_GUIDE.md"Write-Host ""Write-Host "  Press Enter when both KME services are deployed on Render..." -ForegroundColor YellowRead-HostWrite-Host ""Write-Host "[6/6] Update Backend Configuration" -ForegroundColor GreenWrite-Host ""Write-Host "  Enter the Render URLs for your deployed KME services:" -ForegroundColor WhiteWrite-Host ""$kme1Url = Read-Host "  KME 1 (Sender) URL (e.g., https://qumail-kme-sender.onrender.com)"$kme2Url = Read-Host "  KME 2 (Receiver) URL (e.g., https://qumail-kme-receiver.onrender.com)"if ($kme1Url -and $kme2Url) {    Write-Host ""    Write-Host "  Updating backend .env file..." -ForegroundColor Cyan        $backendEnvPath = "..\qumail-backend\.env"    if (Test-Path $backendEnvPath) {        # Update .env file        $envContent = Get-Content $backendEnvPath        $envContent = $envContent -replace "KM1_BASE_URL=.*", "KM1_BASE_URL=$kme1Url"        $envContent = $envContent -replace "KM2_BASE_URL=.*", "KM2_BASE_URL=$kme2Url"        $envContent | Set-Content $backendEnvPath                Write-Host "  Γ£ô Backend .env updated!" -ForegroundColor Green        Write-Host "    KM1_BASE_URL=$kme1Url" -ForegroundColor Gray        Write-Host "    KM2_BASE_URL=$kme2Url" -ForegroundColor Gray    } else {        Write-Host "  ! Backend .env not found at: $backendEnvPath" -ForegroundColor Yellow        Write-Host "  Please manually update your backend .env with:" -ForegroundColor Yellow        Write-Host "    KM1_BASE_URL=$kme1Url" -ForegroundColor Gray        Write-Host "    KM2_BASE_URL=$kme2Url" -ForegroundColor Gray    }}Write-Host ""Write-Host "======================================================================" -ForegroundColor GreenWrite-Host "  Γ£ô Deployment Setup Complete!" -ForegroundColor GreenWrite-Host "======================================================================" -ForegroundColor GreenWrite-Host ""Write-Host "Next Steps:" -ForegroundColor CyanWrite-Host ""Write-Host "1. Test KME connectivity:" -ForegroundColor WhiteWrite-Host "   cd ..\qumail-backend" -ForegroundColor GrayWrite-Host "   python test_cloud_kme.py" -ForegroundColor GrayWrite-Host ""Write-Host "2. Start your backend server:" -ForegroundColor WhiteWrite-Host "   cd ..\qumail-backend" -ForegroundColor GrayWrite-Host "   python -m uvicorn app.main:app --reload --port 8000" -ForegroundColor GrayWrite-Host ""Write-Host "3. Test full encryption flow:" -ForegroundColor WhiteWrite-Host "   Send an encrypted email through QuMail" -ForegroundColor GrayWrite-Host ""Write-Host "Important Notes:" -ForegroundColor YellowWrite-Host "  ΓÇó Free tier services sleep after 15 min of inactivity" -ForegroundColor GrayWrite-Host "  ΓÇó First request after sleep takes 30-60 seconds" -ForegroundColor GrayWrite-Host "  ΓÇó Consider upgrading to Starter plan ($7/month) for production" -ForegroundColor GrayWrite-Host ""Write-Host "For detailed instructions, see: RENDER_DEPLOYMENT_GUIDE.md" -ForegroundColor CyanWrite-Host ""Read-Host "Press Enter to exit"